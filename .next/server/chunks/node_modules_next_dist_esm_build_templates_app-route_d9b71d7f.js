module.exports=[58164,e=>{"use strict";var t=e.i(47909),a=e.i(74017),n=e.i(96250),o=e.i(59756),s=e.i(61916),r=e.i(14444),i=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),m=e.i(66012),g=e.i(70101),f=e.i(26937),h=e.i(10372),v=e.i(93695);e.i(52474);var _=e.i(5232),R=e.i(89171),C=e.i(89660);async function A(e){try{var t,a;let n,o,s,r,i,l,c,d=await (0,C.createClient)(),u=e.nextUrl.searchParams,p=u.get("startDate"),m=u.get("endDate"),g=u.get("accounts"),f=g?g.split(",").filter(Boolean):[],h=u.get("customers"),v=h?h.split(",").filter(Boolean):[],{data:{user:_}}=await d.auth.getUser();if(!_)return R.NextResponse.json({adAccounts:[],campaigns:[],metrics:{totalSpend:0,totalRevenue:0,totalImpressions:0,totalClicks:0,totalConversions:0,roas:0,ctr:0},hasData:!1});let{data:A}=await d.from("profiles").select("tenant_id").eq("id",_.id).single();if(!A?.tenant_id)return R.NextResponse.json({adAccounts:[],campaigns:[],metrics:{totalSpend:0,totalRevenue:0,totalImpressions:0,totalClicks:0,totalConversions:0,roas:0,ctr:0},hasData:!1});let w=A.tenant_id,{data:k,error:y}=await d.from("ad_accounts").select("id, account_id, platform, account_name, status, last_synced_at").eq("tenant_id",w).order("platform");y&&console.error("Error fetching ad accounts:",y);let{data:x,error:E}=await d.from("campaigns").select("id, platform, campaign_name, status, budget_amount, ad_account_id, customer_id, customer_name").eq("tenant_id",w);E&&console.error("Error fetching campaigns:",E);let S=d.from("campaign_metrics").select("impressions, clicks, conversions, spend, revenue, date, campaign_id").eq("tenant_id",w);if(p&&(S=S.gte("date",p)),m&&(S=S.lte("date",m)),f.length>0||v.length>0){let e=d.from("campaigns").select("id").eq("tenant_id",w);f.length>0&&(e=e.in("ad_account_id",f)),v.length>0&&(e=e.in("customer_id",v));let{data:t}=await e;if(t&&t.length>0){let e=t.map(e=>e.id);S=S.in("campaign_id",e)}else S=S.eq("campaign_id","no-match")}let{data:b,error:N}=await S;N&&console.error("Error fetching metrics:",N);let M=(k||[]).map(e=>({id:e.id||e.account_id||`${e.platform}-${e.account_name}`,name:e.account_name||"Unnamed Account",platform:"google_ads"===e.platform?"Google Ads":"meta_ads"===e.platform?"Meta Ads":"linkedin_ads"===e.platform?"LinkedIn Ads":e.platform})),I=new Map;(x||[]).forEach(e=>{if(e.customer_id&&e.customer_name){let t=`${e.platform}-${e.customer_id}`;I.has(t)||I.set(t,{id:e.customer_id,name:e.customer_name,platform:"google_ads"===e.platform?"Google Ads":"meta_ads"===e.platform?"Meta Ads":"linkedin_ads"===e.platform?"LinkedIn Ads":e.platform})}});let P=Array.from(I.values()).sort((e,t)=>e.platform.localeCompare(t.platform)||e.name.localeCompare(t.name));console.log(`Data API: Found ${k?.length||0} ad accounts, ${x?.length||0} campaigns, ${b?.length||0} metrics for tenant ${w}`);let O=(b||[]).reduce((e,t)=>({totalSpend:e.totalSpend+(Number(t.spend)||0),totalRevenue:e.totalRevenue+(Number(t.revenue)||0),totalImpressions:e.totalImpressions+(t.impressions||0),totalClicks:e.totalClicks+(t.clicks||0),totalConversions:e.totalConversions+(t.conversions||0)}),{totalSpend:0,totalRevenue:0,totalImpressions:0,totalClicks:0,totalConversions:0}),T=O.totalSpend>0?O.totalRevenue/O.totalSpend:0;O.totalImpressions>0&&(O.totalClicks,O.totalImpressions);let $=function(e){let t=new Map;for(let a of e){let e=a.date||new Date().toISOString().split("T")[0],n=t.get(e)||{spend:0,revenue:0,clicks:0,conversions:0};t.set(e,{spend:n.spend+(Number(a.spend)||0),revenue:n.revenue+(Number(a.revenue)||0),clicks:n.clicks+(Number(a.clicks)||0),conversions:n.conversions+(Number(a.conversions)||0)})}return Array.from(t.entries()).sort((e,t)=>e[0].localeCompare(t[0])).slice(-14).map(([e,t])=>({date:new Date(e).toLocaleDateString("en-US",{month:"numeric",day:"numeric"}),spend:Math.round(100*t.spend)/100,revenue:Math.round(100*t.revenue)/100,clicks:t.clicks,conversions:Math.round(100*t.conversions)/100}))}(b||[]),D=function(e,t){let a=new Map;for(let t of e)t.customer_id&&t.customer_name&&a.set(t.id,{customer_id:t.customer_id,customer_name:t.customer_name});let n=new Map;for(let e of t){let t=a.get(e.campaign_id);if(!t)continue;let o=n.get(t.customer_id)||{customer_name:t.customer_name,spend:0,revenue:0,conversions:0,clicks:0,impressions:0};n.set(t.customer_id,{customer_name:t.customer_name,spend:o.spend+(Number(e.spend)||0),revenue:o.revenue+(Number(e.revenue)||0),conversions:o.conversions+(Number(e.conversions)||0),clicks:o.clicks+(Number(e.clicks)||0),impressions:o.impressions+(Number(e.impressions)||0)})}return Array.from(n.entries()).map(([e,t])=>({customer_id:e,customer_name:t.customer_name,spend:Math.round(100*t.spend)/100,revenue:Math.round(100*t.revenue)/100,conversions:Math.round(100*t.conversions)/100,clicks:t.clicks,impressions:t.impressions,ctr:t.impressions>0?t.clicks/t.impressions*100:0,cpc:t.clicks>0?t.spend/t.clicks:0,convRate:t.clicks>0?t.conversions/t.clicks*100:0,roas:t.spend>0?t.revenue/t.spend:0})).sort((e,t)=>t.spend-e.spend)}(x||[],b||[]),q={google:k?.some(e=>"google_ads"===e.platform&&"active"===e.status)||!1,meta:k?.some(e=>"meta_ads"===e.platform&&"active"===e.status)||!1,linkedin:k?.some(e=>"linkedin_ads"===e.platform&&"active"===e.status)||!1},U=function(e,t,a){let n={google_ads:"Google Ads",meta_ads:"Meta Ads",linkedin_ads:"LinkedIn Ads"},o=new Map;for(let t of e)o.set(t.id,t.platform);let s={};for(let e of t){let t=o.get(e.campaign_id)||"google_ads";s[t]||(s[t]={spend:0,conversions:0}),s[t].spend+=Number(e.spend)||0,s[t].conversions+=Number(e.conversions)||0}let r=[];for(let[e,t]of Object.entries(s))r.push({platform:n[e]||e,spend:Math.round(t.spend),conversions:Math.round(t.conversions)});return a.meta&&!s.meta_ads&&r.push({platform:"Meta Ads",spend:0,conversions:0}),a.linkedin&&!s.linkedin_ads&&r.push({platform:"LinkedIn Ads",spend:0,conversions:0}),r}(x||[],b||[],q);return R.NextResponse.json({adAccounts:k||[],campaigns:x||[],metrics:{totalSpend:O.totalSpend,totalConversions:O.totalConversions,averageROAS:T,totalImpressions:O.totalImpressions,totalClicks:O.totalClicks,totalRevenue:O.totalRevenue,spendChange:0,conversionsChange:0,roasChange:0,impressionsChange:0},performanceData:$,platformData:U,customerMetrics:D,connectedPlatforms:q,availableAccounts:M,availableCustomers:P,insights:(t=O,a=D,n=[],o=t.totalSpend>0?t.totalRevenue/t.totalSpend:0,r=(s=[...a].filter(e=>e.spend>100).sort((e,t)=>t.roas-e.roas))[0],i=s[s.length-1],o>=3?n.push({id:"1",title:"Excellent ROAS Performance",description:`Your average ROAS of ${o.toFixed(1)}x is well above industry benchmarks (typically 2-4x). Consider scaling budgets on top performers.`,type:"success",platform:"All Platforms"}):o<2&&t.totalSpend>1e3&&n.push({id:"1",title:"ROAS Below Target",description:`Your average ROAS of ${o.toFixed(1)}x is below the typical 2-4x target. Review underperforming campaigns for optimization opportunities.`,type:"warning",platform:"All Platforms"}),r&&r.roas>1.5*o&&n.push({id:"2",title:`${r.customer_name} Outperforming`,description:`This client is achieving ${r.roas.toFixed(1)}x ROAS, significantly above your average. Consider increasing their budget allocation.`,type:"opportunity",platform:"Google Ads"}),i&&i.roas<.5*o&&i.spend>500&&n.push({id:"3",title:`${i.customer_name} Needs Attention`,description:`This client has ${i.roas.toFixed(1)}x ROAS with $${i.spend.toLocaleString()} spend. Review targeting and creative strategy.`,type:"warning",platform:"Google Ads"}),(l=t.totalImpressions>0?t.totalClicks/t.totalImpressions*100:0)>3&&n.push({id:"4",title:"Strong Click-Through Rate",description:`Your ${l.toFixed(2)}% CTR exceeds the Google Ads average of 2-3%. Your ad copy and targeting are resonating well.`,type:"success",platform:"All Platforms"}),(c=t.totalClicks>0?t.totalConversions/t.totalClicks*100:0)>5&&n.push({id:"5",title:"High Conversion Rate",description:`${c.toFixed(1)}% of clicks are converting - well above the 2-5% industry average. Your landing pages are performing effectively.`,type:"success",platform:"All Platforms"}),0===n.length&&n.push({id:"0",title:"Data Synced Successfully",description:"Your advertising data has been synced. More insights will appear as you accumulate more data.",type:"trend",platform:"All Platforms"}),n.slice(0,4)),hasData:(b?.length||0)>0,dateRange:{startDate:p,endDate:m}})}catch(e){return console.error("API Error:",e),R.NextResponse.json({error:"Failed to fetch data"},{status:500})}}e.s(["GET",()=>A],56305);var w=e.i(56305);let k=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/data/route",pathname:"/api/data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/data/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:y,workUnitAsyncStorage:x,serverHooks:E}=k;function S(){return(0,n.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:x})}async function b(e,t,n){k.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/data/route";R=R.replace(/\/index$/,"")||"/";let C=await k.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:A,params:w,nextConfig:y,parsedUrl:x,isDraftMode:E,prerenderManifest:S,routerServerContext:b,isOnDemandRevalidate:N,revalidateOnlyGenerated:M,resolvedPathname:I,clientReferenceManifest:P,serverActionsManifest:O}=C,T=(0,l.normalizeAppPath)(R),$=!!(S.dynamicRoutes[T]||S.routes[I]),D=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,x,!1):t.end("This page could not be found"),null);if($&&!E){let e=!!S.routes[I],t=S.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await D();throw new v.NoFallbackError}}let q=null;!$||k.isDev||E||(q="/index"===(q=I)?"/":q);let U=!0===k.isDev||!$,H=$&&!U;O&&P&&(0,r.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:P,serverActionsManifest:O,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:O})});let F=e.method||"GET",j=(0,s.getTracer)(),L=j.getActiveScopeSpan(),G={params:w,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>k.onRequestError(e,t,n,b)},sharedContext:{buildId:A}},B=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),Y=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let r=async e=>k.handle(Y,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=j.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${R}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var s,l;let c=async({previousCacheEntry:a})=>{try{if(!i&&N&&M&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await r(o);e.fetchMetrics=G.renderOpts.fetchMetrics;let l=G.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=G.renderOpts.collectedTags;if(!$)return await (0,m.sendResponse)(B,K,s,G.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[h.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,n=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},b),t}},d=await k.handleResponse({req:e,nextConfig:y,cacheKey:q,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:M,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:i});if(!$)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&$||u.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(B,K,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};L?await l(L):await j.withPropagatedContext(e.headers,()=>j.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})}),$)throw t;return await (0,m.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>S,"routeModule",()=>k,"serverHooks",()=>E,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>x],58164)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_d9b71d7f.js.map