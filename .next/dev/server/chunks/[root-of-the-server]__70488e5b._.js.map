{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/logging/logger.ts"],"sourcesContent":["/**\r\n * Winston Structured Logging Configuration\r\n * Provides comprehensive logging for all API operations\r\n */\r\n\r\nimport winston from 'winston'\r\nimport path from 'path'\r\n\r\n// Define log levels\r\nconst levels = {\r\n  error: 0,\r\n  warn: 1,\r\n  info: 2,\r\n  http: 3,\r\n  debug: 4,\r\n}\r\n\r\n// Define colors for each level\r\nconst colors = {\r\n  error: 'red',\r\n  warn: 'yellow',\r\n  info: 'green',\r\n  http: 'magenta',\r\n  debug: 'white',\r\n}\r\n\r\n// Tell winston about our colors\r\nwinston.addColors(colors)\r\n\r\n// Define log format\r\nconst format = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss:ms' }),\r\n  winston.format.colorize({ all: true }),\r\n  winston.format.printf(\r\n    (info) => `${info.timestamp} ${info.level}: ${info.message}`\r\n  )\r\n)\r\n\r\n// Define log format for files (JSON)\r\nconst fileFormat = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss:ms' }),\r\n  winston.format.json()\r\n)\r\n\r\n// Define which transports the logger must use\r\nconst transports = [\r\n  // Console transport\r\n  new winston.transports.Console({\r\n    format: format,\r\n  }),\r\n  // Error log file\r\n  new winston.transports.File({\r\n    filename: path.join(process.cwd(), 'logs', 'error.log'),\r\n    level: 'error',\r\n    format: fileFormat,\r\n  }),\r\n  // Combined log file\r\n  new winston.transports.File({\r\n    filename: path.join(process.cwd(), 'logs', 'combined.log'),\r\n    format: fileFormat,\r\n  }),\r\n  // API-specific log file\r\n  new winston.transports.File({\r\n    filename: path.join(process.cwd(), 'logs', 'api.log'),\r\n    level: 'http',\r\n    format: fileFormat,\r\n  }),\r\n]\r\n\r\n// Create the logger\r\nconst logger = winston.createLogger({\r\n  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',\r\n  levels,\r\n  transports,\r\n})\r\n\r\n/**\r\n * Custom error class for platform API errors\r\n */\r\nexport class PlatformAPIError extends Error {\r\n  platform: string\r\n  operation: string\r\n  originalError: any\r\n  timestamp: string\r\n  statusCode?: number\r\n  errorCode?: string\r\n\r\n  constructor(\r\n    platform: string,\r\n    operation: string,\r\n    originalError: any,\r\n    statusCode?: number,\r\n    errorCode?: string\r\n  ) {\r\n    super(`${platform} API error during ${operation}`)\r\n    this.platform = platform\r\n    this.operation = operation\r\n    this.originalError = originalError\r\n    this.timestamp = new Date().toISOString()\r\n    this.statusCode = statusCode\r\n    this.errorCode = errorCode\r\n    this.name = 'PlatformAPIError'\r\n\r\n    // Log the error\r\n    logger.error('Platform API Error', {\r\n      platform,\r\n      operation,\r\n      error: originalError.message || originalError,\r\n      stack: originalError.stack,\r\n      statusCode,\r\n      errorCode,\r\n      timestamp: this.timestamp,\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Log successful API call\r\n */\r\nexport function logAPISuccess(\r\n  platform: string,\r\n  operation: string,\r\n  details?: Record<string, any>\r\n) {\r\n  logger.http('API Success', {\r\n    platform,\r\n    operation,\r\n    timestamp: new Date().toISOString(),\r\n    ...details,\r\n  })\r\n}\r\n\r\n/**\r\n * Log OAuth flow events\r\n */\r\nexport function logOAuthEvent(\r\n  platform: string,\r\n  event: 'initiated' | 'callback' | 'success' | 'failure',\r\n  userId?: string,\r\n  error?: any\r\n) {\r\n  const level = event === 'failure' ? 'error' : 'info'\r\n  \r\n  logger.log(level, 'OAuth Event', {\r\n    platform,\r\n    event,\r\n    userId,\r\n    error: error?.message,\r\n    timestamp: new Date().toISOString(),\r\n  })\r\n}\r\n\r\n/**\r\n * Log data sync operations\r\n */\r\nexport function logSyncOperation(\r\n  platform: string,\r\n  status: 'started' | 'completed' | 'failed',\r\n  details: {\r\n    userId?: string\r\n    campaignsCount?: number\r\n    metricsCount?: number\r\n    error?: any\r\n    duration?: number\r\n  }\r\n) {\r\n  const level = status === 'failed' ? 'error' : 'info'\r\n  \r\n  logger.log(level, 'Data Sync', {\r\n    platform,\r\n    status,\r\n    timestamp: new Date().toISOString(),\r\n    ...details,\r\n  })\r\n}\r\n\r\n/**\r\n * Log token refresh operations\r\n */\r\nexport function logTokenRefresh(\r\n  platform: string,\r\n  success: boolean,\r\n  userId?: string,\r\n  error?: any\r\n) {\r\n  const level = success ? 'info' : 'error'\r\n  \r\n  logger.log(level, 'Token Refresh', {\r\n    platform,\r\n    success,\r\n    userId,\r\n    error: error?.message,\r\n    timestamp: new Date().toISOString(),\r\n  })\r\n}\r\n\r\n/**\r\n * Log rate limiting events\r\n */\r\nexport function logRateLimit(\r\n  platform: string,\r\n  rateLimitInfo: {\r\n    remaining?: number\r\n    limit?: number\r\n    resetAt?: string\r\n    throttled: boolean\r\n  }\r\n) {\r\n  logger.warn('Rate Limit Warning', {\r\n    platform,\r\n    ...rateLimitInfo,\r\n    timestamp: new Date().toISOString(),\r\n  })\r\n}\r\n\r\n/**\r\n * Log cache operations\r\n */\r\nexport function logCacheOperation(\r\n  operation: 'hit' | 'miss' | 'set' | 'delete',\r\n  key: string,\r\n  details?: Record<string, any>\r\n) {\r\n  logger.debug('Cache Operation', {\r\n    operation,\r\n    key,\r\n    timestamp: new Date().toISOString(),\r\n    ...details,\r\n  })\r\n}\r\n\r\nexport default logger\r\n\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;;;AAED;AACA;;;AAEA,oBAAoB;AACpB,MAAM,SAAS;IACb,OAAO;IACP,MAAM;IACN,MAAM;IACN,MAAM;IACN,OAAO;AACT;AAEA,+BAA+B;AAC/B,MAAM,SAAS;IACb,OAAO;IACP,MAAM;IACN,MAAM;IACN,MAAM;IACN,OAAO;AACT;AAEA,gCAAgC;AAChC,sJAAO,CAAC,SAAS,CAAC;AAElB,oBAAoB;AACpB,MAAM,SAAS,sJAAO,CAAC,MAAM,CAAC,OAAO,CACnC,sJAAO,CAAC,MAAM,CAAC,SAAS,CAAC;IAAE,QAAQ;AAAyB,IAC5D,sJAAO,CAAC,MAAM,CAAC,QAAQ,CAAC;IAAE,KAAK;AAAK,IACpC,sJAAO,CAAC,MAAM,CAAC,MAAM,CACnB,CAAC,OAAS,GAAG,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,EAAE,EAAE,KAAK,OAAO,EAAE;AAIhE,qCAAqC;AACrC,MAAM,aAAa,sJAAO,CAAC,MAAM,CAAC,OAAO,CACvC,sJAAO,CAAC,MAAM,CAAC,SAAS,CAAC;IAAE,QAAQ;AAAyB,IAC5D,sJAAO,CAAC,MAAM,CAAC,IAAI;AAGrB,8CAA8C;AAC9C,MAAM,aAAa;IACjB,oBAAoB;IACpB,IAAI,sJAAO,CAAC,UAAU,CAAC,OAAO,CAAC;QAC7B,QAAQ;IACV;IACA,iBAAiB;IACjB,IAAI,sJAAO,CAAC,UAAU,CAAC,IAAI,CAAC;QAC1B,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;QAC3C,OAAO;QACP,QAAQ;IACV;IACA,oBAAoB;IACpB,IAAI,sJAAO,CAAC,UAAU,CAAC,IAAI,CAAC;QAC1B,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;QAC3C,QAAQ;IACV;IACA,wBAAwB;IACxB,IAAI,sJAAO,CAAC,UAAU,CAAC,IAAI,CAAC;QAC1B,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;QAC3C,OAAO;QACP,QAAQ;IACV;CACD;AAED,oBAAoB;AACpB,MAAM,SAAS,sJAAO,CAAC,YAAY,CAAC;IAClC,OAAO,sCAAwC,0BAAS;IACxD;IACA;AACF;AAKO,MAAM,yBAAyB;IACpC,SAAgB;IAChB,UAAiB;IACjB,cAAkB;IAClB,UAAiB;IACjB,WAAmB;IACnB,UAAkB;IAElB,YACE,QAAgB,EAChB,SAAiB,EACjB,aAAkB,EAClB,UAAmB,EACnB,SAAkB,CAClB;QACA,KAAK,CAAC,GAAG,SAAS,kBAAkB,EAAE,WAAW;QACjD,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,SAAS,GAAG,IAAI,OAAO,WAAW;QACvC,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,IAAI,GAAG;QAEZ,gBAAgB;QAChB,OAAO,KAAK,CAAC,sBAAsB;YACjC;YACA;YACA,OAAO,cAAc,OAAO,IAAI;YAChC,OAAO,cAAc,KAAK;YAC1B;YACA;YACA,WAAW,IAAI,CAAC,SAAS;QAC3B;IACF;AACF;AAKO,SAAS,cACd,QAAgB,EAChB,SAAiB,EACjB,OAA6B;IAE7B,OAAO,IAAI,CAAC,eAAe;QACzB;QACA;QACA,WAAW,IAAI,OAAO,WAAW;QACjC,GAAG,OAAO;IACZ;AACF;AAKO,SAAS,cACd,QAAgB,EAChB,KAAuD,EACvD,MAAe,EACf,KAAW;IAEX,MAAM,QAAQ,UAAU,YAAY,UAAU;IAE9C,OAAO,GAAG,CAAC,OAAO,eAAe;QAC/B;QACA;QACA;QACA,OAAO,OAAO;QACd,WAAW,IAAI,OAAO,WAAW;IACnC;AACF;AAKO,SAAS,iBACd,QAAgB,EAChB,MAA0C,EAC1C,OAMC;IAED,MAAM,QAAQ,WAAW,WAAW,UAAU;IAE9C,OAAO,GAAG,CAAC,OAAO,aAAa;QAC7B;QACA;QACA,WAAW,IAAI,OAAO,WAAW;QACjC,GAAG,OAAO;IACZ;AACF;AAKO,SAAS,gBACd,QAAgB,EAChB,OAAgB,EAChB,MAAe,EACf,KAAW;IAEX,MAAM,QAAQ,UAAU,SAAS;IAEjC,OAAO,GAAG,CAAC,OAAO,iBAAiB;QACjC;QACA;QACA;QACA,OAAO,OAAO;QACd,WAAW,IAAI,OAAO,WAAW;IACnC;AACF;AAKO,SAAS,aACd,QAAgB,EAChB,aAKC;IAED,OAAO,IAAI,CAAC,sBAAsB;QAChC;QACA,GAAG,aAAa;QAChB,WAAW,IAAI,OAAO,WAAW;IACnC;AACF;AAKO,SAAS,kBACd,SAA4C,EAC5C,GAAW,EACX,OAA6B;IAE7B,OAAO,KAAK,CAAC,mBAAmB;QAC9B;QACA;QACA,WAAW,IAAI,OAAO,WAAW;QACjC,GAAG,OAAO;IACZ;AACF;uCAEe"}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/security/encryption.ts"],"sourcesContent":["/**\r\n * Token Encryption Utilities\r\n * Uses AES-256-GCM for secure token storage\r\n */\r\n\r\nimport crypto from 'crypto'\r\n\r\nconst ALGORITHM = 'aes-256-gcm'\r\nconst IV_LENGTH = 16\r\nconst AUTH_TAG_LENGTH = 16\r\n\r\ninterface EncryptedData {\r\n  encrypted: string\r\n  iv: string\r\n  authTag: string\r\n}\r\n\r\n/**\r\n * Get encryption key from environment variable\r\n * In production, this should be stored in a secure key management service\r\n */\r\nfunction getEncryptionKey(): Buffer {\r\n  const key = process.env.ENCRYPTION_KEY\r\n  \r\n  if (!key) {\r\n    throw new Error(\r\n      'ENCRYPTION_KEY environment variable is not set. ' +\r\n      'Generate one using: openssl rand -hex 32'\r\n    )\r\n  }\r\n  \r\n  // Ensure key is 32 bytes (64 hex characters)\r\n  if (key.length !== 64) {\r\n    throw new Error('ENCRYPTION_KEY must be 64 hex characters (32 bytes)')\r\n  }\r\n  \r\n  return Buffer.from(key, 'hex')\r\n}\r\n\r\n/**\r\n * Encrypt sensitive data (tokens, secrets) before storing in database\r\n */\r\nexport function encryptToken(plaintext: string): EncryptedData {\r\n  try {\r\n    const key = getEncryptionKey()\r\n    const iv = crypto.randomBytes(IV_LENGTH)\r\n    \r\n    const cipher = crypto.createCipheriv(ALGORITHM, key, iv)\r\n    \r\n    let encrypted = cipher.update(plaintext, 'utf8', 'hex')\r\n    encrypted += cipher.final('hex')\r\n    \r\n    const authTag = cipher.getAuthTag()\r\n    \r\n    return {\r\n      encrypted: encrypted,\r\n      iv: iv.toString('hex'),\r\n      authTag: authTag.toString('hex'),\r\n    }\r\n  } catch (error) {\r\n    throw new Error(`Token encryption failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\r\n  }\r\n}\r\n\r\n/**\r\n * Decrypt sensitive data when retrieving from database\r\n */\r\nexport function decryptToken(encryptedData: EncryptedData): string {\r\n  try {\r\n    const key = getEncryptionKey()\r\n    \r\n    const decipher = crypto.createDecipheriv(\r\n      ALGORITHM,\r\n      key,\r\n      Buffer.from(encryptedData.iv, 'hex')\r\n    )\r\n    \r\n    decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex'))\r\n    \r\n    let decrypted = decipher.update(encryptedData.encrypted, 'hex', 'utf8')\r\n    decrypted += decipher.final('utf8')\r\n    \r\n    return decrypted\r\n  } catch (error) {\r\n    throw new Error(`Token decryption failed: ${error instanceof Error ? error.message : 'Unknown error'}`)\r\n  }\r\n}\r\n\r\n/**\r\n * Generate a secure encryption key\r\n * Run this once and store the result in ENCRYPTION_KEY env variable\r\n */\r\nexport function generateEncryptionKey(): string {\r\n  return crypto.randomBytes(32).toString('hex')\r\n}\r\n\r\n/**\r\n * Encrypt multiple fields in an object\r\n */\r\nexport function encryptFields<T extends Record<string, any>>(\r\n  data: T,\r\n  fieldsToEncrypt: (keyof T)[]\r\n): Record<string, any> {\r\n  const encrypted: Record<string, any> = { ...data }\r\n  \r\n  for (const field of fieldsToEncrypt) {\r\n    const fieldStr = String(field)\r\n    const value = data[field]\r\n    if (value && typeof value === 'string') {\r\n      const encryptedData = encryptToken(value)\r\n      encrypted[`${fieldStr}_encrypted`] = encryptedData.encrypted\r\n      encrypted[`${fieldStr}_iv`] = encryptedData.iv\r\n      encrypted[`${fieldStr}_auth_tag`] = encryptedData.authTag\r\n      delete encrypted[fieldStr]\r\n    }\r\n  }\r\n  \r\n  return encrypted\r\n}\r\n\r\n/**\r\n * Decrypt multiple fields in an object\r\n */\r\nexport function decryptFields<T extends Record<string, any>>(\r\n  data: T,\r\n  fieldsToDecrypt: string[]\r\n): Record<string, any> {\r\n  const decrypted: Record<string, any> = { ...data }\r\n  \r\n  for (const field of fieldsToDecrypt) {\r\n    const encryptedField = `${field}_encrypted`\r\n    const ivField = `${field}_iv`\r\n    const authTagField = `${field}_auth_tag`\r\n    \r\n    if (data[encryptedField] && data[ivField] && data[authTagField]) {\r\n      try {\r\n        const encryptedData: EncryptedData = {\r\n          encrypted: data[encryptedField] as string,\r\n          iv: data[ivField] as string,\r\n          authTag: data[authTagField] as string,\r\n        }\r\n        \r\n        decrypted[field] = decryptToken(encryptedData)\r\n        delete decrypted[encryptedField]\r\n        delete decrypted[ivField]\r\n        delete decrypted[authTagField]\r\n      } catch (error) {\r\n        console.error(`Failed to decrypt field ${field}:`, error)\r\n        // Keep encrypted fields if decryption fails\r\n      }\r\n    }\r\n  }\r\n  \r\n  return decrypted\r\n}\r\n\r\n/**\r\n * Utility to test encryption/decryption\r\n */\r\nexport function testEncryption(): boolean {\r\n  try {\r\n    const testData = 'test-token-12345'\r\n    const encrypted = encryptToken(testData)\r\n    const decrypted = decryptToken(encrypted)\r\n    \r\n    return decrypted === testData\r\n  } catch (error) {\r\n    console.error('Encryption test failed:', error)\r\n    return false\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 445, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/supabase/service-role.ts"],"sourcesContent":["import { createClient, SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Creates a Supabase client with service role privileges.\n * This client bypasses Row Level Security and should only be used\n * for server-side operations that need elevated permissions.\n * \n * @throws Error if environment variables are not set at runtime\n */\nexport function createServiceRoleClient(): SupabaseClient {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!supabaseUrl) {\n    throw new Error(\n      'NEXT_PUBLIC_SUPABASE_URL environment variable is not set. ' +\n      'Please add it to your .env.local file.'\n    )\n  }\n\n  if (!supabaseServiceRoleKey) {\n    throw new Error(\n      'SUPABASE_SERVICE_ROLE_KEY environment variable is not set. ' +\n      'Please add it to your .env.local file.'\n    )\n  }\n\n  return createClient(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n      persistSession: false,\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;;AASO,SAAS;IACd,MAAM;IACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;IAEpE;;IAOA,IAAI,CAAC,wBAAwB;QAC3B,MAAM,IAAI,MACR,gEACA;IAEJ;IAEA,OAAO,IAAA,yMAAY,EAAC,aAAa,wBAAwB;QACvD,MAAM;YACJ,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 469, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/security/ad-account-tokens.ts"],"sourcesContent":["import logger from '../logging/logger'\r\nimport { encryptToken, decryptToken } from './encryption'\r\nimport { createServiceRoleClient } from '../supabase/service-role'\r\n\r\ninterface TokenUpdateInput {\r\n  accessToken?: string | null\r\n  refreshToken?: string | null\r\n}\r\n\r\ninterface DecryptedTokens {\r\n  accessToken: string | null\r\n  refreshToken: string | null\r\n}\r\n\r\nfunction buildEncryptedFields(token?: string | null) {\r\n  if (!token) {\r\n    return null\r\n  }\r\n\r\n  const encrypted = encryptToken(token)\r\n\r\n  return {\r\n    encrypted: encrypted.encrypted,\r\n    iv: encrypted.iv,\r\n    authTag: encrypted.authTag,\r\n  }\r\n}\r\n\r\nexport function buildEncryptedTokenUpdate(tokens: TokenUpdateInput) {\r\n  const update: Record<string, any> = {}\r\n\r\n  const access = buildEncryptedFields(tokens.accessToken)\r\n  if (access) {\r\n    update.access_token_encrypted = access.encrypted\r\n    update.access_token_iv = access.iv\r\n    update.access_token_auth_tag = access.authTag\r\n    update.access_token = null\r\n  }\r\n\r\n  const refresh = buildEncryptedFields(tokens.refreshToken)\r\n  if (refresh) {\r\n    update.refresh_token_encrypted = refresh.encrypted\r\n    update.refresh_token_iv = refresh.iv\r\n    update.refresh_token_auth_tag = refresh.authTag\r\n    update.refresh_token = null\r\n  }\r\n\r\n  return update\r\n}\r\n\r\nexport function decryptAccountTokens(account: any): DecryptedTokens {\r\n  let accessToken: string | null = null\r\n  let refreshToken: string | null = null\r\n\r\n  if (\r\n    account?.access_token_encrypted &&\r\n    account?.access_token_iv &&\r\n    account?.access_token_auth_tag\r\n  ) {\r\n    try {\r\n      accessToken = decryptToken({\r\n        encrypted: account.access_token_encrypted,\r\n        iv: account.access_token_iv,\r\n        authTag: account.access_token_auth_tag,\r\n      })\r\n    } catch (error) {\r\n      logger.error('Failed to decrypt access token', {\r\n        accountId: account?.id,\r\n        platform: account?.platform,\r\n        error,\r\n      })\r\n    }\r\n  } else if (account?.access_token) {\r\n    accessToken = account.access_token\r\n  }\r\n\r\n  if (\r\n    account?.refresh_token_encrypted &&\r\n    account?.refresh_token_iv &&\r\n    account?.refresh_token_auth_tag\r\n  ) {\r\n    try {\r\n      refreshToken = decryptToken({\r\n        encrypted: account.refresh_token_encrypted,\r\n        iv: account.refresh_token_iv,\r\n        authTag: account.refresh_token_auth_tag,\r\n      })\r\n    } catch (error) {\r\n      logger.error('Failed to decrypt refresh token', {\r\n        accountId: account?.id,\r\n        platform: account?.platform,\r\n        error,\r\n      })\r\n    }\r\n  } else if (account?.refresh_token) {\r\n    refreshToken = account.refresh_token\r\n  }\r\n\r\n  return { accessToken, refreshToken }\r\n}\r\n\r\nexport async function migratePlaintextTokens() {\r\n  try {\r\n    const supabase = createServiceRoleClient()\r\n\r\n    const { data: accounts, error } = await supabase\r\n      .from('ad_accounts')\r\n      .select(\r\n        'id, platform, access_token, refresh_token, access_token_encrypted, refresh_token_encrypted'\r\n      )\r\n      .or('access_token.not.is.null,refresh_token.not.is.null')\r\n\r\n    if (error) {\r\n      logger.error('Failed to query ad accounts for token migration', { error })\r\n      return\r\n    }\r\n\r\n    if (!accounts || accounts.length === 0) {\r\n      logger.info('No plaintext tokens found to migrate')\r\n      return\r\n    }\r\n\r\n    logger.info('Migrating plaintext ad account tokens', {\r\n      accounts: accounts.length,\r\n    })\r\n\r\n    for (const account of accounts) {\r\n      const update = buildEncryptedTokenUpdate({\r\n        accessToken: account.access_token,\r\n        refreshToken: account.refresh_token,\r\n      })\r\n\r\n      if (Object.keys(update).length === 0) {\r\n        continue\r\n      }\r\n\r\n      update.updated_at = new Date().toISOString()\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('ad_accounts')\r\n        .update(update)\r\n        .eq('id', account.id)\r\n\r\n      if (updateError) {\r\n        logger.error('Failed to migrate tokens for ad account', {\r\n          accountId: account.id,\r\n          platform: account.platform,\r\n          error: updateError,\r\n        })\r\n      }\r\n    }\r\n\r\n    logger.info('Plaintext token migration completed')\r\n  } catch (error) {\r\n    logger.error('Token migration failed', { error })\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 600, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/app/api/sync-data/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport logger, { logSyncOperation } from '@/lib/logging/logger'\r\nimport { decryptAccountTokens } from '@/lib/security/ad-account-tokens'\r\n\r\nexport async function POST(_request: NextRequest) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    // Check authentication\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Get user's profile and tenant\r\n    const { data: profile } = await supabase\r\n      .from('profiles')\r\n      .select('tenant_id')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (!profile?.tenant_id) {\r\n      return NextResponse.json({ error: 'No tenant found' }, { status: 404 })\r\n    }\r\n\r\n    // Get connected ad accounts\r\n    const { data: adAccounts } = await supabase\r\n      .from('ad_accounts')\r\n      .select('*')\r\n      .eq('tenant_id', profile.tenant_id)\r\n      .eq('status', 'active')\r\n\r\n    if (!adAccounts || adAccounts.length === 0) {\r\n      return NextResponse.json({ error: 'No ad accounts connected' }, { status: 404 })\r\n    }\r\n\r\n    const accountsWithTokens = adAccounts.map((account) => ({\r\n      ...account,\r\n      tokens: decryptAccountTokens(account),\r\n    }))\r\n\r\n    const syncResults = []\r\n\r\n    // Sync data from each platform\r\n    for (const account of accountsWithTokens) {\r\n      const startTime = Date.now()\r\n      \r\n      try {\r\n        logSyncOperation(account.platform, 'started', { userId: user.id })\r\n\r\n        if (account.platform === 'google_ads') {\r\n          const result = await syncGoogleAdsData(\r\n            supabase,\r\n            account,\r\n            profile.tenant_id,\r\n            account.tokens\r\n          )\r\n          logSyncOperation(account.platform, 'completed', {\r\n            userId: user.id,\r\n            campaignsCount: result?.campaignsCount || 0,\r\n            metricsCount: result?.metricsCount || 0,\r\n            duration: Date.now() - startTime,\r\n          })\r\n          syncResults.push({\r\n            platform: 'google_ads',\r\n            status: 'success',\r\n            campaigns: result?.campaignsCount || 0,\r\n            metrics: result?.metricsCount || 0,\r\n          })\r\n        } else if (account.platform === 'meta_ads') {\r\n          const result = await syncMetaAdsData(\r\n            supabase,\r\n            account,\r\n            profile.tenant_id,\r\n            account.tokens\r\n          )\r\n          logSyncOperation(account.platform, 'completed', {\r\n            userId: user.id,\r\n            campaignsCount: result?.campaignsCount || 0,\r\n            metricsCount: result?.metricsCount || 0,\r\n            duration: Date.now() - startTime,\r\n          })\r\n          syncResults.push({\r\n            platform: 'meta_ads',\r\n            status: 'success',\r\n            campaigns: result?.campaignsCount || 0,\r\n            metrics: result?.metricsCount || 0,\r\n          })\r\n        } else if (account.platform === 'linkedin_ads') {\r\n          const result = await syncLinkedInAdsData(\r\n            supabase,\r\n            account,\r\n            profile.tenant_id,\r\n            account.tokens\r\n          )\r\n          logSyncOperation(account.platform, 'completed', {\r\n            userId: user.id,\r\n            campaignsCount: result?.campaignsCount || 0,\r\n            metricsCount: result?.metricsCount || 0,\r\n            duration: Date.now() - startTime,\r\n          })\r\n          syncResults.push({\r\n            platform: 'linkedin_ads',\r\n            status: 'success',\r\n            campaigns: result?.campaignsCount || 0,\r\n            metrics: result?.metricsCount || 0,\r\n          })\r\n        }\r\n\r\n        // Update last synced time\r\n        await supabase\r\n          .from('ad_accounts')\r\n          .update({ last_synced_at: new Date().toISOString() })\r\n          .eq('id', account.id)\r\n      } catch (err: any) {\r\n        logger.error(`Error syncing ${account.platform}:`, { error: err, userId: user.id })\r\n        logSyncOperation(account.platform, 'failed', {\r\n          userId: user.id,\r\n          error: err,\r\n          duration: Date.now() - startTime,\r\n        })\r\n        syncResults.push({ platform: account.platform, status: 'error', message: err.message })\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      message: 'Data sync initiated',\r\n      results: syncResults \r\n    })\r\n  } catch (error: any) {\r\n    console.error('Sync error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to sync data', details: error.message },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nasync function syncGoogleAdsData(supabase: any, account: any, tenantId: string, tokens: any) {\r\n  const { fetchGoogleAdsCampaigns, transformGoogleAdsData } = await import('@/lib/google-ads/client')\r\n  \r\n  if (!tokens?.refreshToken) {\r\n    throw new Error('Google Ads refresh token missing. Please reconnect your account.')\r\n  }\r\n\r\n  if (!account.metadata?.client_id || !account.metadata?.client_secret || !account.metadata?.developer_token) {\r\n    throw new Error('Google Ads credentials incomplete. Please reconfigure in settings.')\r\n  }\r\n\r\n  const config = {\r\n    clientId: account.metadata.client_id,\r\n    clientSecret: account.metadata.client_secret,\r\n    developerToken: account.metadata.developer_token,\r\n    customerId: account.account_id,\r\n    refreshToken: tokens.refreshToken,\r\n    loginCustomerId: account.metadata?.login_customer_id,\r\n  }\r\n\r\n  // Fetch real campaign data from Google Ads API\r\n  const apiData = await fetchGoogleAdsCampaigns(config)\r\n  console.log(`Google Ads API returned ${apiData?.results?.length || 0} result rows`)\r\n  \r\n  const { campaigns: campaignData, metrics: metricsData } = transformGoogleAdsData(apiData)\r\n  console.log(`Transformed: ${campaignData.length} campaigns, ${metricsData.length} metrics`)\r\n\r\n  if (campaignData.length === 0) {\r\n    logger.info('No Google Ads campaigns found for this account')\r\n    return { campaignsCount: 0, metricsCount: 0 }\r\n  }\r\n\r\n  // Insert campaigns into database\r\n  const campaignsToInsert = campaignData.map((c: any) => ({\r\n    ...c,\r\n    tenant_id: tenantId,\r\n    ad_account_id: account.id,\r\n  }))\r\n\r\n  console.log(`Inserting ${campaignsToInsert.length} campaigns for tenant ${tenantId}`)\r\n  \r\n  const { data: campaigns, error: campaignsError } = await supabase\r\n    .from('campaigns')\r\n    .upsert(campaignsToInsert, { onConflict: 'campaign_id,tenant_id' })\r\n    .select()\r\n\r\n  if (campaignsError) {\r\n    console.error('Error inserting campaigns:', campaignsError)\r\n    throw new Error(`Failed to save campaigns: ${campaignsError.message}`)\r\n  }\r\n  \r\n  console.log(`Successfully inserted/updated ${campaigns?.length || 0} campaigns`)\r\n\r\n  // Insert metrics - map API campaign IDs to database IDs\r\n  let metricsInserted = 0\r\n  if (campaigns && campaigns.length > 0 && metricsData.length > 0) {\r\n    const campaignIdMap = new Map(campaigns.map((c: any) => [c.campaign_id, c.id]))\r\n    \r\n    const metricsToInsert = metricsData\r\n      .map((m: any) => {\r\n        const dbCampaignId = campaignIdMap.get(m.campaign_api_id)\r\n        if (!dbCampaignId) return null\r\n        \r\n        // Remove campaign_api_id before inserting\r\n        const { campaign_api_id, ...metricData } = m\r\n        \r\n        return {\r\n          ...metricData,\r\n          tenant_id: tenantId,\r\n          campaign_id: dbCampaignId,\r\n        }\r\n      })\r\n      .filter((m: any) => m !== null)\r\n\r\n    if (metricsToInsert.length > 0) {\r\n      console.log(`Inserting ${metricsToInsert.length} metrics for tenant ${tenantId}`)\r\n      \r\n      const { error: metricsError } = await supabase.from('campaign_metrics').upsert(metricsToInsert)\r\n      \r\n      if (metricsError) {\r\n        console.error('Error inserting metrics:', metricsError)\r\n      } else {\r\n        metricsInserted = metricsToInsert.length\r\n        console.log(`Successfully inserted/updated ${metricsInserted} metrics`)\r\n      }\r\n    }\r\n  }\r\n\r\n  return { campaignsCount: campaigns?.length || 0, metricsCount: metricsInserted }\r\n}\r\n\r\n\r\nasync function syncMetaAdsData(supabase: any, account: any, tenantId: string, tokens: any) {\r\n  const { fetchMetaAdsCampaigns, transformMetaAdsData } = await import('@/lib/meta-ads/client')\r\n\r\n  if (!tokens?.accessToken) {\r\n    throw new Error('Meta Ads access token missing. Please reconnect your account in Settings.')\r\n  }\r\n\r\n  const config = {\r\n    accessToken: tokens.accessToken,\r\n    accountId: account.account_id,\r\n    apiVersion: account.metadata?.api_version,\r\n    appSecret: account.metadata?.app_secret, // Pass app secret for App Secret Proof\r\n  }\r\n\r\n  try {\r\n    // Fetch real campaign data from Meta Ads API\r\n    const apiData = await fetchMetaAdsCampaigns(config)\r\n    const { campaigns: campaignData, metrics: metricsData } = transformMetaAdsData(apiData)\r\n\r\n    if (campaignData.length === 0) {\r\n      logger.info('No Meta Ads campaigns found for this account')\r\n      return { campaignsCount: 0, metricsCount: 0 }\r\n    }\r\n\r\n    // Insert campaigns into database\r\n    const campaignsToInsert = campaignData.map((c: any) => ({\r\n      ...c,\r\n      tenant_id: tenantId,\r\n      ad_account_id: account.id,\r\n    }))\r\n\r\n    const { data: campaigns, error: campaignsError } = await supabase\r\n      .from('campaigns')\r\n      .upsert(campaignsToInsert, { onConflict: 'campaign_id,tenant_id' })\r\n      .select()\r\n\r\n    if (campaignsError) {\r\n      logger.error('Failed to insert Meta Ads campaigns', { error: campaignsError })\r\n      throw new Error(`Failed to save campaigns: ${campaignsError.message}`)\r\n    }\r\n\r\n    // Insert metrics - map API campaign IDs to database IDs\r\n    let metricsInserted = 0\r\n    if (campaigns && campaigns.length > 0 && metricsData.length > 0) {\r\n      const campaignIdMap = new Map(campaigns.map((c: any) => [c.campaign_id, c.id]))\r\n      \r\n      const metricsToInsert = metricsData\r\n        .map((m: any) => {\r\n          const dbCampaignId = campaignIdMap.get(m.campaign_api_id)\r\n          if (!dbCampaignId) return null\r\n          \r\n          // Remove campaign_api_id before inserting\r\n          const { campaign_api_id, ...metricData } = m\r\n          \r\n          return {\r\n            ...metricData,\r\n            tenant_id: tenantId,\r\n            campaign_id: dbCampaignId,\r\n          }\r\n        })\r\n        .filter((m: any) => m !== null)\r\n\r\n      if (metricsToInsert.length > 0) {\r\n        const { error: metricsError } = await supabase.from('campaign_metrics').upsert(metricsToInsert)\r\n        if (metricsError) {\r\n          logger.error('Failed to insert Meta Ads metrics', { error: metricsError })\r\n          throw new Error(`Failed to save metrics: ${metricsError.message}`)\r\n        }\r\n        metricsInserted = metricsToInsert.length\r\n      }\r\n    }\r\n\r\n    return { campaignsCount: campaigns?.length || 0, metricsCount: metricsInserted }\r\n  } catch (error: any) {\r\n    // Re-throw with helpful context\r\n    if (error.message?.includes('Access token expired') || error.message?.includes('invalid')) {\r\n      throw new Error('Meta Ads access token expired. Please reconnect your account in Settings.')\r\n    }\r\n    if (error.message?.includes('Rate limit')) {\r\n      throw new Error('Meta Ads rate limit exceeded. Please try again later.')\r\n    }\r\n    throw error\r\n  }\r\n}\r\n\r\n\r\nasync function syncLinkedInAdsData(supabase: any, account: any, tenantId: string, tokens: any) {\r\n  const { fetchLinkedInAdsCampaigns, transformLinkedInAdsData } = await import('@/lib/linkedin-ads/client')\r\n  \r\n  if (!tokens?.accessToken) {\r\n    throw new Error('LinkedIn Ads access token missing. Please reconnect your account in Settings.')\r\n  }\r\n\r\n  const config = {\r\n    accessToken: tokens.accessToken,\r\n    apiVersion: account.metadata?.api_version || '202505',\r\n  }\r\n\r\n  try {\r\n    // Fetch real campaign data from LinkedIn Ads API\r\n    const apiData = await fetchLinkedInAdsCampaigns(config)\r\n    \r\n    if (!apiData || apiData.length === 0) {\r\n      logger.info('No LinkedIn campaigns found for this account')\r\n      return { campaignsCount: 0, metricsCount: 0 }\r\n    }\r\n    \r\n    const { campaigns: campaignData, metrics: metricsData } = transformLinkedInAdsData(apiData)\r\n\r\n    if (campaignData.length === 0) {\r\n      logger.info('No LinkedIn Ads campaigns found for this account')\r\n      return { campaignsCount: 0, metricsCount: 0 }\r\n    }\r\n\r\n    // Insert campaigns into database\r\n    const campaignsToInsert = campaignData.map((c: any) => ({\r\n      ...c,\r\n      tenant_id: tenantId,\r\n      ad_account_id: account.id,\r\n    }))\r\n\r\n    const { data: campaigns, error: campaignsError } = await supabase\r\n      .from('campaigns')\r\n      .upsert(campaignsToInsert, { onConflict: 'campaign_id,tenant_id' })\r\n      .select()\r\n\r\n    if (campaignsError) {\r\n      logger.error('Failed to insert LinkedIn Ads campaigns', { error: campaignsError })\r\n      throw new Error(`Failed to save campaigns: ${campaignsError.message}`)\r\n    }\r\n\r\n    // Insert metrics - map API campaign IDs to database IDs\r\n    let metricsInserted = 0\r\n    if (campaigns && campaigns.length > 0 && metricsData.length > 0) {\r\n      const campaignIdMap = new Map(campaigns.map((c: any) => [c.campaign_id, c.id]))\r\n      \r\n      const metricsToInsert = metricsData\r\n        .map((m: any) => {\r\n          const dbCampaignId = campaignIdMap.get(m.campaign_api_id)\r\n          if (!dbCampaignId) return null\r\n          \r\n          // Remove campaign_api_id before inserting\r\n          const { campaign_api_id, ...metricData } = m\r\n          \r\n          return {\r\n            ...metricData,\r\n            tenant_id: tenantId,\r\n            campaign_id: dbCampaignId,\r\n          }\r\n        })\r\n        .filter((m: any) => m !== null)\r\n\r\n      if (metricsToInsert.length > 0) {\r\n        const { error: metricsError } = await supabase.from('campaign_metrics').upsert(metricsToInsert)\r\n        if (metricsError) {\r\n          logger.error('Failed to insert LinkedIn Ads metrics', { error: metricsError })\r\n          throw new Error(`Failed to save metrics: ${metricsError.message}`)\r\n        }\r\n        metricsInserted = metricsToInsert.length\r\n      }\r\n    }\r\n\r\n    return { campaignsCount: campaigns?.length || 0, metricsCount: metricsInserted }\r\n  } catch (error: any) {\r\n    // Re-throw with helpful context\r\n    if (error.message?.includes('Access token expired') || error.message?.includes('invalid')) {\r\n      throw new Error('LinkedIn Ads access token expired. Please reconnect your account in Settings.')\r\n    }\r\n    if (error.message?.includes('Rate limit')) {\r\n      throw new Error('LinkedIn Ads rate limit exceeded. Please try again later.')\r\n    }\r\n    if (error.message?.includes('No LinkedIn ad accounts found')) {\r\n      throw new Error('No LinkedIn ad accounts found. Ensure your account has Marketing API access approved.')\r\n    }\r\n    throw error\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}