{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/app/api/data/client/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n    \n    // Get the current user\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\n    \n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user's profile to find tenant_id\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('tenant_id')\n      .eq('id', user.id)\n      .single();\n\n    if (profileError || !profile?.tenant_id) {\n      return NextResponse.json({ error: 'Profile not found' }, { status: 404 });\n    }\n\n    // Get query parameters\n    const { searchParams } = new URL(request.url);\n    const clientId = searchParams.get('clientId');\n    const startDate = searchParams.get('startDate');\n    const endDate = searchParams.get('endDate');\n\n    if (!clientId) {\n      return NextResponse.json({ error: 'Client ID required' }, { status: 400 });\n    }\n\n    // Get client info from campaigns\n    const { data: clientCampaigns, error: campaignsError } = await supabase\n      .from('campaigns')\n      .select('id, campaign_name, platform, status, budget_amount, customer_id, customer_name')\n      .eq('tenant_id', profile.tenant_id)\n      .eq('customer_id', clientId);\n\n    if (campaignsError) {\n      console.error('Error fetching client campaigns:', campaignsError);\n      return NextResponse.json({ error: 'Failed to fetch client data' }, { status: 500 });\n    }\n\n    if (!clientCampaigns || clientCampaigns.length === 0) {\n      return NextResponse.json({ error: 'Client not found' }, { status: 404 });\n    }\n\n    const clientInfo = {\n      id: clientId,\n      name: clientCampaigns[0].customer_name || 'Unknown Client',\n      platform: clientCampaigns[0].platform || 'google_ads',\n    };\n\n    // Get campaign IDs for this client\n    const campaignIds = clientCampaigns.map(c => c.id);\n\n    // Build metrics query\n    let metricsQuery = supabase\n      .from('campaign_metrics')\n      .select('*')\n      .eq('tenant_id', profile.tenant_id)\n      .in('campaign_id', campaignIds);\n\n    if (startDate) {\n      metricsQuery = metricsQuery.gte('date', startDate);\n    }\n    if (endDate) {\n      metricsQuery = metricsQuery.lte('date', endDate);\n    }\n\n    const { data: metrics, error: metricsError } = await metricsQuery;\n\n    if (metricsError) {\n      console.error('Error fetching metrics:', metricsError);\n      return NextResponse.json({ error: 'Failed to fetch metrics' }, { status: 500 });\n    }\n\n    // Calculate aggregated metrics\n    const totalSpend = metrics?.reduce((sum, m) => sum + (m.spend || 0), 0) || 0;\n    const totalRevenue = metrics?.reduce((sum, m) => sum + (m.revenue || 0), 0) || 0;\n    const totalConversions = metrics?.reduce((sum, m) => sum + (m.conversions || 0), 0) || 0;\n    const totalClicks = metrics?.reduce((sum, m) => sum + (m.clicks || 0), 0) || 0;\n    const totalImpressions = metrics?.reduce((sum, m) => sum + (m.impressions || 0), 0) || 0;\n\n    const aggregatedMetrics = {\n      totalSpend,\n      totalRevenue,\n      totalConversions,\n      totalClicks,\n      totalImpressions,\n      averageROAS: totalSpend > 0 ? totalRevenue / totalSpend : 0,\n      ctr: totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0,\n      cpc: totalClicks > 0 ? totalSpend / totalClicks : 0,\n      convRate: totalClicks > 0 ? (totalConversions / totalClicks) * 100 : 0,\n    };\n\n    // Group metrics by date for performance chart\n    const metricsByDate = (metrics || []).reduce((acc, m) => {\n      const date = m.date;\n      if (!acc[date]) {\n        acc[date] = { spend: 0, revenue: 0, clicks: 0, conversions: 0 };\n      }\n      acc[date].spend += m.spend || 0;\n      acc[date].revenue += m.revenue || 0;\n      acc[date].clicks += m.clicks || 0;\n      acc[date].conversions += m.conversions || 0;\n      return acc;\n    }, {} as Record<string, { spend: number; revenue: number; clicks: number; conversions: number }>);\n\n    const performanceData = Object.entries(metricsByDate)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([date, data]) => ({\n        date: new Date(date).toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' }),\n        ...data,\n      }));\n\n    // Calculate per-campaign metrics\n    const campaignMetrics = clientCampaigns.map(campaign => {\n      const campaignData = (metrics || []).filter(m => m.campaign_id === campaign.id);\n      const spend = campaignData.reduce((sum, m) => sum + (m.spend || 0), 0);\n      const revenue = campaignData.reduce((sum, m) => sum + (m.revenue || 0), 0);\n      const conversions = campaignData.reduce((sum, m) => sum + (m.conversions || 0), 0);\n      const clicks = campaignData.reduce((sum, m) => sum + (m.clicks || 0), 0);\n      const impressions = campaignData.reduce((sum, m) => sum + (m.impressions || 0), 0);\n\n      return {\n        id: campaign.id,\n        name: campaign.campaign_name,\n        status: campaign.status || 'unknown',\n        spend,\n        revenue,\n        conversions,\n        clicks,\n        impressions,\n        ctr: impressions > 0 ? (clicks / impressions) * 100 : 0,\n        cpc: clicks > 0 ? spend / clicks : 0,\n        convRate: clicks > 0 ? (conversions / clicks) * 100 : 0,\n        roas: spend > 0 ? revenue / spend : 0,\n      };\n    }).sort((a, b) => b.spend - a.spend);\n\n    // Get all clients for switcher\n    const { data: allCustomers, error: customersError } = await supabase\n      .from('campaigns')\n      .select('customer_id, customer_name, platform')\n      .eq('tenant_id', profile.tenant_id)\n      .not('customer_id', 'is', null);\n\n    // Deduplicate customers\n    const uniqueCustomers = Array.from(\n      new Map((allCustomers || []).map(c => [c.customer_id, c])).values()\n    ).map(c => ({\n      id: c.customer_id,\n      name: c.customer_name || c.customer_id,\n      platform: c.platform,\n    }));\n\n    return NextResponse.json({\n      client: clientInfo,\n      metrics: aggregatedMetrics,\n      performanceData,\n      campaigns: campaignMetrics,\n      allClients: uniqueCustomers,\n    });\n  } catch (error) {\n    console.error('Client API error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}