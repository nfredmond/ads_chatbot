{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/app/api/data/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { NextRequest } from 'next/server';\r\nimport { createClient } from '@/lib/supabase/server';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const supabase = await createClient();\r\n    \r\n    // Parse filter parameters\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const accountsParam = searchParams.get('accounts');\r\n    const selectedAccountIds = accountsParam ? accountsParam.split(',').filter(Boolean) : [];\r\n    const customersParam = searchParams.get('customers');\r\n    const selectedCustomerIds = customersParam ? customersParam.split(',').filter(Boolean) : [];\r\n    \r\n    // Get authenticated user\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    \r\n    if (!user) {\r\n      return NextResponse.json({ \r\n        adAccounts: [], \r\n        campaigns: [], \r\n        metrics: { totalSpend: 0, totalRevenue: 0, totalImpressions: 0, totalClicks: 0, totalConversions: 0, roas: 0, ctr: 0 },\r\n        hasData: false \r\n      });\r\n    }\r\n\r\n    // Get user's tenant\r\n    const { data: profile } = await supabase\r\n      .from('profiles')\r\n      .select('tenant_id')\r\n      .eq('id', user.id)\r\n      .single();\r\n\r\n    if (!profile?.tenant_id) {\r\n      return NextResponse.json({ \r\n        adAccounts: [], \r\n        campaigns: [], \r\n        metrics: { totalSpend: 0, totalRevenue: 0, totalImpressions: 0, totalClicks: 0, totalConversions: 0, roas: 0, ctr: 0 },\r\n        hasData: false \r\n      });\r\n    }\r\n\r\n    const tenantId = profile.tenant_id;\r\n\r\n    // Fetch ad accounts for this tenant\r\n    const { data: adAccounts, error: accountsError } = await supabase\r\n      .from('ad_accounts')\r\n      .select('id, account_id, platform, account_name, status, last_synced_at')\r\n      .eq('tenant_id', tenantId)\r\n      .order('platform');\r\n\r\n    if (accountsError) {\r\n      console.error('Error fetching ad accounts:', accountsError);\r\n    }\r\n\r\n    // Fetch campaigns for this tenant (include customer info)\r\n    const { data: campaigns, error: campaignsError } = await supabase\r\n      .from('campaigns')\r\n      .select('id, platform, campaign_name, status, budget_amount, ad_account_id, customer_id, customer_name')\r\n      .eq('tenant_id', tenantId);\r\n\r\n    if (campaignsError) {\r\n      console.error('Error fetching campaigns:', campaignsError);\r\n    }\r\n\r\n    // Build metrics query with optional date range filtering\r\n    let metricsQuery = supabase\r\n      .from('campaign_metrics')\r\n      .select('impressions, clicks, conversions, spend, revenue, date, campaign_id')\r\n      .eq('tenant_id', tenantId);\r\n\r\n    // Apply date range filter if provided\r\n    if (startDate) {\r\n      metricsQuery = metricsQuery.gte('date', startDate);\r\n    }\r\n    if (endDate) {\r\n      metricsQuery = metricsQuery.lte('date', endDate);\r\n    }\r\n\r\n    // Apply account filter if provided (filter by campaign_id which relates to accounts)\r\n    if (selectedAccountIds.length > 0 || selectedCustomerIds.length > 0) {\r\n      // Build query to get matching campaign IDs\r\n      let campaignQuery = supabase\r\n        .from('campaigns')\r\n        .select('id')\r\n        .eq('tenant_id', tenantId);\r\n      \r\n      if (selectedAccountIds.length > 0) {\r\n        campaignQuery = campaignQuery.in('ad_account_id', selectedAccountIds);\r\n      }\r\n      \r\n      if (selectedCustomerIds.length > 0) {\r\n        campaignQuery = campaignQuery.in('customer_id', selectedCustomerIds);\r\n      }\r\n      \r\n      const { data: filteredCampaigns } = await campaignQuery;\r\n      \r\n      if (filteredCampaigns && filteredCampaigns.length > 0) {\r\n        const campaignIds = filteredCampaigns.map(c => c.id);\r\n        metricsQuery = metricsQuery.in('campaign_id', campaignIds);\r\n      } else {\r\n        // No matching campaigns, return empty metrics\r\n        metricsQuery = metricsQuery.eq('campaign_id', 'no-match');\r\n      }\r\n    }\r\n\r\n    const { data: metrics, error: metricsError } = await metricsQuery;\r\n\r\n    if (metricsError) {\r\n      console.error('Error fetching metrics:', metricsError);\r\n    }\r\n\r\n    // Build available accounts list for the filter dropdown\r\n    const availableAccounts = (adAccounts || []).map((acc: any) => ({\r\n      id: acc.id || acc.account_id || `${acc.platform}-${acc.account_name}`,\r\n      name: acc.account_name || 'Unnamed Account',\r\n      platform: acc.platform === 'google_ads' ? 'Google Ads' \r\n        : acc.platform === 'meta_ads' ? 'Meta Ads' \r\n        : acc.platform === 'linkedin_ads' ? 'LinkedIn Ads' \r\n        : acc.platform,\r\n    }));\r\n\r\n    // Build available customers list grouped by platform\r\n    const customerMap = new Map<string, { id: string; name: string; platform: string }>();\r\n    (campaigns || []).forEach((campaign: any) => {\r\n      if (campaign.customer_id && campaign.customer_name) {\r\n        const key = `${campaign.platform}-${campaign.customer_id}`;\r\n        if (!customerMap.has(key)) {\r\n          customerMap.set(key, {\r\n            id: campaign.customer_id,\r\n            name: campaign.customer_name,\r\n            platform: campaign.platform === 'google_ads' ? 'Google Ads' \r\n              : campaign.platform === 'meta_ads' ? 'Meta Ads' \r\n              : campaign.platform === 'linkedin_ads' ? 'LinkedIn Ads' \r\n              : campaign.platform,\r\n          });\r\n        }\r\n      }\r\n    });\r\n    const availableCustomers = Array.from(customerMap.values()).sort((a, b) => \r\n      a.platform.localeCompare(b.platform) || a.name.localeCompare(b.name)\r\n    );\r\n\r\n    console.log(`Data API: Found ${adAccounts?.length || 0} ad accounts, ${campaigns?.length || 0} campaigns, ${metrics?.length || 0} metrics for tenant ${tenantId}`);\r\n\r\n    // Calculate aggregated metrics\r\n    const aggregatedMetrics = (metrics || []).reduce(\r\n      (acc, m) => ({\r\n        totalSpend: acc.totalSpend + (Number(m.spend) || 0),\r\n        totalRevenue: acc.totalRevenue + (Number(m.revenue) || 0),\r\n        totalImpressions: acc.totalImpressions + (m.impressions || 0),\r\n        totalClicks: acc.totalClicks + (m.clicks || 0),\r\n        totalConversions: acc.totalConversions + (m.conversions || 0),\r\n      }),\r\n      {\r\n        totalSpend: 0,\r\n        totalRevenue: 0,\r\n        totalImpressions: 0,\r\n        totalClicks: 0,\r\n        totalConversions: 0,\r\n      }\r\n    );\r\n\r\n    const roas = aggregatedMetrics.totalSpend > 0 \r\n      ? aggregatedMetrics.totalRevenue / aggregatedMetrics.totalSpend \r\n      : 0;\r\n    \r\n    const ctr = aggregatedMetrics.totalImpressions > 0 \r\n      ? (aggregatedMetrics.totalClicks / aggregatedMetrics.totalImpressions) * 100 \r\n      : 0;\r\n\r\n    // Build performance data for charts (last 30 days)\r\n    const performanceData = buildPerformanceData(metrics || []);\r\n\r\n    // Build customer metrics for the client performance table\r\n    const customerMetrics = buildCustomerMetrics(campaigns || [], metrics || []);\r\n\r\n    // Check connected platforms\r\n    const connectedPlatforms = {\r\n      google: adAccounts?.some(a => a.platform === 'google_ads' && a.status === 'active') || false,\r\n      meta: adAccounts?.some(a => a.platform === 'meta_ads' && a.status === 'active') || false,\r\n      linkedin: adAccounts?.some(a => a.platform === 'linkedin_ads' && a.status === 'active') || false,\r\n    };\r\n    \r\n    // Build platform comparison data (only for connected platforms with data)\r\n    const platformData = buildPlatformData(campaigns || [], metrics || [], connectedPlatforms);\r\n\r\n    return NextResponse.json({\r\n      adAccounts: adAccounts || [],\r\n      campaigns: campaigns || [],\r\n      metrics: {\r\n        totalSpend: aggregatedMetrics.totalSpend,\r\n        totalConversions: aggregatedMetrics.totalConversions,\r\n        averageROAS: roas,\r\n        totalImpressions: aggregatedMetrics.totalImpressions,\r\n        totalClicks: aggregatedMetrics.totalClicks,\r\n        totalRevenue: aggregatedMetrics.totalRevenue,\r\n        spendChange: 0, // TODO: Calculate from historical data\r\n        conversionsChange: 0,\r\n        roasChange: 0,\r\n        impressionsChange: 0,\r\n      },\r\n      performanceData,\r\n      platformData,\r\n      customerMetrics,\r\n      connectedPlatforms,\r\n      availableAccounts,\r\n      availableCustomers,\r\n      insights: generateInsights(aggregatedMetrics, campaigns || [], customerMetrics),\r\n      hasData: (metrics?.length || 0) > 0,\r\n      dateRange: { startDate, endDate },\r\n    });\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch data' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nfunction buildPerformanceData(metrics: any[]) {\r\n  // Group metrics by date\r\n  const byDate = new Map<string, { spend: number; revenue: number; clicks: number; conversions: number }>();\r\n  \r\n  for (const m of metrics) {\r\n    const date = m.date || new Date().toISOString().split('T')[0];\r\n    const existing = byDate.get(date) || { spend: 0, revenue: 0, clicks: 0, conversions: 0 };\r\n    byDate.set(date, {\r\n      spend: existing.spend + (Number(m.spend) || 0),\r\n      revenue: existing.revenue + (Number(m.revenue) || 0),\r\n      clicks: existing.clicks + (Number(m.clicks) || 0),\r\n      conversions: existing.conversions + (Number(m.conversions) || 0),\r\n    });\r\n  }\r\n\r\n  // Sort by date and format\r\n  return Array.from(byDate.entries())\r\n    .sort((a, b) => a[0].localeCompare(b[0]))\r\n    .slice(-14) // Last 14 days\r\n    .map(([date, data]) => ({\r\n      date: new Date(date).toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' }),\r\n      spend: Math.round(data.spend * 100) / 100,\r\n      revenue: Math.round(data.revenue * 100) / 100,\r\n      clicks: data.clicks,\r\n      conversions: Math.round(data.conversions * 100) / 100,\r\n    }));\r\n}\r\n\r\nfunction buildCustomerMetrics(campaigns: any[], metrics: any[]) {\r\n  // Build a map of campaign_id to customer info\r\n  const campaignCustomerMap = new Map<string, { customer_id: string; customer_name: string }>();\r\n  for (const campaign of campaigns) {\r\n    if (campaign.customer_id && campaign.customer_name) {\r\n      campaignCustomerMap.set(campaign.id, {\r\n        customer_id: campaign.customer_id,\r\n        customer_name: campaign.customer_name,\r\n      });\r\n    }\r\n  }\r\n\r\n  // Aggregate metrics by customer\r\n  const customerStats = new Map<string, {\r\n    customer_name: string;\r\n    spend: number;\r\n    revenue: number;\r\n    conversions: number;\r\n    clicks: number;\r\n    impressions: number;\r\n  }>();\r\n\r\n  for (const metric of metrics) {\r\n    const customerInfo = campaignCustomerMap.get(metric.campaign_id);\r\n    if (!customerInfo) continue;\r\n\r\n    const existing = customerStats.get(customerInfo.customer_id) || {\r\n      customer_name: customerInfo.customer_name,\r\n      spend: 0,\r\n      revenue: 0,\r\n      conversions: 0,\r\n      clicks: 0,\r\n      impressions: 0,\r\n    };\r\n\r\n    customerStats.set(customerInfo.customer_id, {\r\n      customer_name: customerInfo.customer_name,\r\n      spend: existing.spend + (Number(metric.spend) || 0),\r\n      revenue: existing.revenue + (Number(metric.revenue) || 0),\r\n      conversions: existing.conversions + (Number(metric.conversions) || 0),\r\n      clicks: existing.clicks + (Number(metric.clicks) || 0),\r\n      impressions: existing.impressions + (Number(metric.impressions) || 0),\r\n    });\r\n  }\r\n\r\n  // Convert to array with calculated metrics\r\n  return Array.from(customerStats.entries()).map(([customer_id, stats]) => ({\r\n    customer_id,\r\n    customer_name: stats.customer_name,\r\n    spend: Math.round(stats.spend * 100) / 100,\r\n    revenue: Math.round(stats.revenue * 100) / 100,\r\n    conversions: Math.round(stats.conversions * 100) / 100,\r\n    clicks: stats.clicks,\r\n    impressions: stats.impressions,\r\n    ctr: stats.impressions > 0 ? (stats.clicks / stats.impressions) * 100 : 0,\r\n    cpc: stats.clicks > 0 ? stats.spend / stats.clicks : 0,\r\n    convRate: stats.clicks > 0 ? (stats.conversions / stats.clicks) * 100 : 0,\r\n    roas: stats.spend > 0 ? stats.revenue / stats.spend : 0,\r\n  })).sort((a, b) => b.spend - a.spend);\r\n}\r\n\r\nfunction buildPlatformData(campaigns: any[], metrics: any[], connectedPlatforms: any) {\r\n  const platformNames: Record<string, string> = {\r\n    'google_ads': 'Google Ads',\r\n    'meta_ads': 'Meta Ads',\r\n    'linkedin_ads': 'LinkedIn Ads',\r\n  };\r\n\r\n  // Build a map of campaign_id to platform\r\n  const campaignPlatformMap = new Map<string, string>();\r\n  for (const campaign of campaigns) {\r\n    campaignPlatformMap.set(campaign.id, campaign.platform);\r\n  }\r\n\r\n  // Aggregate metrics by platform\r\n  const platformStats: Record<string, { spend: number; conversions: number }> = {};\r\n  \r\n  for (const metric of metrics) {\r\n    const platform = campaignPlatformMap.get(metric.campaign_id) || 'google_ads';\r\n    if (!platformStats[platform]) {\r\n      platformStats[platform] = { spend: 0, conversions: 0 };\r\n    }\r\n    platformStats[platform].spend += Number(metric.spend) || 0;\r\n    platformStats[platform].conversions += Number(metric.conversions) || 0;\r\n  }\r\n\r\n  // Only return platforms that have data or are connected\r\n  const result = [];\r\n  \r\n  for (const [platform, stats] of Object.entries(platformStats)) {\r\n    result.push({\r\n      platform: platformNames[platform] || platform,\r\n      spend: Math.round(stats.spend),\r\n      conversions: Math.round(stats.conversions),\r\n    });\r\n  }\r\n\r\n  // Add connected platforms with zero data if they're not in the results\r\n  if (connectedPlatforms.meta && !platformStats['meta_ads']) {\r\n    result.push({ platform: 'Meta Ads', spend: 0, conversions: 0 });\r\n  }\r\n  if (connectedPlatforms.linkedin && !platformStats['linkedin_ads']) {\r\n    result.push({ platform: 'LinkedIn Ads', spend: 0, conversions: 0 });\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction generateInsights(metrics: any, campaigns: any[], customerMetrics: any[]) {\r\n  const insights = [];\r\n  \r\n  // Calculate average ROAS\r\n  const avgRoas = metrics.totalSpend > 0 ? metrics.totalRevenue / metrics.totalSpend : 0;\r\n  \r\n  // Find top and bottom performers\r\n  const sortedByRoas = [...customerMetrics].filter(c => c.spend > 100).sort((a, b) => b.roas - a.roas);\r\n  const topPerformer = sortedByRoas[0];\r\n  const bottomPerformer = sortedByRoas[sortedByRoas.length - 1];\r\n\r\n  // ROAS insight\r\n  if (avgRoas >= 3) {\r\n    insights.push({\r\n      id: '1',\r\n      title: 'Excellent ROAS Performance',\r\n      description: `Your average ROAS of ${avgRoas.toFixed(1)}x is well above industry benchmarks (typically 2-4x). Consider scaling budgets on top performers.`,\r\n      type: 'success',\r\n      platform: 'All Platforms',\r\n    });\r\n  } else if (avgRoas < 2 && metrics.totalSpend > 1000) {\r\n    insights.push({\r\n      id: '1',\r\n      title: 'ROAS Below Target',\r\n      description: `Your average ROAS of ${avgRoas.toFixed(1)}x is below the typical 2-4x target. Review underperforming campaigns for optimization opportunities.`,\r\n      type: 'warning',\r\n      platform: 'All Platforms',\r\n    });\r\n  }\r\n\r\n  // Top performer insight\r\n  if (topPerformer && topPerformer.roas > avgRoas * 1.5) {\r\n    insights.push({\r\n      id: '2',\r\n      title: `${topPerformer.customer_name} Outperforming`,\r\n      description: `This client is achieving ${topPerformer.roas.toFixed(1)}x ROAS, significantly above your average. Consider increasing their budget allocation.`,\r\n      type: 'opportunity',\r\n      platform: 'Google Ads',\r\n    });\r\n  }\r\n\r\n  // Bottom performer insight\r\n  if (bottomPerformer && bottomPerformer.roas < avgRoas * 0.5 && bottomPerformer.spend > 500) {\r\n    insights.push({\r\n      id: '3',\r\n      title: `${bottomPerformer.customer_name} Needs Attention`,\r\n      description: `This client has ${bottomPerformer.roas.toFixed(1)}x ROAS with $${bottomPerformer.spend.toLocaleString()} spend. Review targeting and creative strategy.`,\r\n      type: 'warning',\r\n      platform: 'Google Ads',\r\n    });\r\n  }\r\n\r\n  // CTR insight\r\n  const avgCtr = metrics.totalImpressions > 0 ? (metrics.totalClicks / metrics.totalImpressions) * 100 : 0;\r\n  if (avgCtr > 3) {\r\n    insights.push({\r\n      id: '4',\r\n      title: 'Strong Click-Through Rate',\r\n      description: `Your ${avgCtr.toFixed(2)}% CTR exceeds the Google Ads average of 2-3%. Your ad copy and targeting are resonating well.`,\r\n      type: 'success',\r\n      platform: 'All Platforms',\r\n    });\r\n  }\r\n\r\n  // Conversion rate insight\r\n  const convRate = metrics.totalClicks > 0 ? (metrics.totalConversions / metrics.totalClicks) * 100 : 0;\r\n  if (convRate > 5) {\r\n    insights.push({\r\n      id: '5',\r\n      title: 'High Conversion Rate',\r\n      description: `${convRate.toFixed(1)}% of clicks are converting - well above the 2-5% industry average. Your landing pages are performing effectively.`,\r\n      type: 'success',\r\n      platform: 'All Platforms',\r\n    });\r\n  }\r\n\r\n  // Default insight if none generated\r\n  if (insights.length === 0) {\r\n    insights.push({\r\n      id: '0',\r\n      title: 'Data Synced Successfully',\r\n      description: 'Your advertising data has been synced. More insights will appear as you accumulate more data.',\r\n      type: 'trend',\r\n      platform: 'All Platforms',\r\n    });\r\n  }\r\n\r\n  return insights.slice(0, 4); // Return top 4 insights\r\n}\r\n"],"names":[],"mappings":"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"}}]
}