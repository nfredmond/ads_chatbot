{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Code/Mike%20Strickler/ADs%20Chatbot/ai-gateway-experiment/app/api/data/route.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\nimport { NextResponse } from 'next/server';\r\n\r\n// Initialize Supabase client\r\nconst supabase = createClient(\r\n  process.env.SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_ANON_KEY!\r\n);\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Fetch ad accounts\r\n    const { data: adAccounts, error: accountsError } = await supabase\r\n      .from('ad_accounts')\r\n      .select('platform, account_name, status, last_synced_at')\r\n      .order('platform');\r\n\r\n    if (accountsError) {\r\n      console.error('Error fetching ad accounts:', accountsError);\r\n    }\r\n\r\n    // Fetch campaigns\r\n    const { data: campaigns, error: campaignsError } = await supabase\r\n      .from('campaigns')\r\n      .select('id, platform, campaign_name, status, budget_amount');\r\n\r\n    if (campaignsError) {\r\n      console.error('Error fetching campaigns:', campaignsError);\r\n    }\r\n\r\n    // Fetch metrics\r\n    const { data: metrics, error: metricsError } = await supabase\r\n      .from('campaign_metrics')\r\n      .select('impressions, clicks, conversions, spend, revenue');\r\n\r\n    if (metricsError) {\r\n      console.error('Error fetching metrics:', metricsError);\r\n    }\r\n\r\n    // Calculate aggregated metrics\r\n    const aggregatedMetrics = (metrics || []).reduce(\r\n      (acc, m) => ({\r\n        totalSpend: acc.totalSpend + (Number(m.spend) || 0),\r\n        totalRevenue: acc.totalRevenue + (Number(m.revenue) || 0),\r\n        totalImpressions: acc.totalImpressions + (m.impressions || 0),\r\n        totalClicks: acc.totalClicks + (m.clicks || 0),\r\n        totalConversions: acc.totalConversions + (m.conversions || 0),\r\n      }),\r\n      {\r\n        totalSpend: 0,\r\n        totalRevenue: 0,\r\n        totalImpressions: 0,\r\n        totalClicks: 0,\r\n        totalConversions: 0,\r\n      }\r\n    );\r\n\r\n    const roas = aggregatedMetrics.totalSpend > 0 \r\n      ? aggregatedMetrics.totalRevenue / aggregatedMetrics.totalSpend \r\n      : 0;\r\n    \r\n    const ctr = aggregatedMetrics.totalImpressions > 0 \r\n      ? (aggregatedMetrics.totalClicks / aggregatedMetrics.totalImpressions) * 100 \r\n      : 0;\r\n\r\n    return NextResponse.json({\r\n      adAccounts: adAccounts || [],\r\n      campaigns: campaigns || [],\r\n      metrics: {\r\n        ...aggregatedMetrics,\r\n        roas,\r\n        ctr,\r\n      },\r\n      hasData: (metrics?.length || 0) > 0,\r\n    });\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch data' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,6BAA6B;AAC7B,MAAM,WAAW,IAAA,yMAAY,EAC3B,QAAQ,GAAG,CAAC,YAAY,EACxB,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,iBAAiB;AAGjE,eAAe;IACpB,IAAI;QACF,oBAAoB;QACpB,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,eACL,MAAM,CAAC,kDACP,KAAK,CAAC;QAET,IAAI,eAAe;YACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC/C;QAEA,kBAAkB;QAClB,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,aACL,MAAM,CAAC;QAEV,IAAI,gBAAgB;YAClB,QAAQ,KAAK,CAAC,6BAA6B;QAC7C;QAEA,gBAAgB;QAChB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,oBACL,MAAM,CAAC;QAEV,IAAI,cAAc;YAChB,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;QAEA,+BAA+B;QAC/B,MAAM,oBAAoB,CAAC,WAAW,EAAE,EAAE,MAAM,CAC9C,CAAC,KAAK,IAAM,CAAC;gBACX,YAAY,IAAI,UAAU,GAAG,CAAC,OAAO,EAAE,KAAK,KAAK,CAAC;gBAClD,cAAc,IAAI,YAAY,GAAG,CAAC,OAAO,EAAE,OAAO,KAAK,CAAC;gBACxD,kBAAkB,IAAI,gBAAgB,GAAG,CAAC,EAAE,WAAW,IAAI,CAAC;gBAC5D,aAAa,IAAI,WAAW,GAAG,CAAC,EAAE,MAAM,IAAI,CAAC;gBAC7C,kBAAkB,IAAI,gBAAgB,GAAG,CAAC,EAAE,WAAW,IAAI,CAAC;YAC9D,CAAC,GACD;YACE,YAAY;YACZ,cAAc;YACd,kBAAkB;YAClB,aAAa;YACb,kBAAkB;QACpB;QAGF,MAAM,OAAO,kBAAkB,UAAU,GAAG,IACxC,kBAAkB,YAAY,GAAG,kBAAkB,UAAU,GAC7D;QAEJ,MAAM,MAAM,kBAAkB,gBAAgB,GAAG,IAC7C,AAAC,kBAAkB,WAAW,GAAG,kBAAkB,gBAAgB,GAAI,MACvE;QAEJ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,YAAY,cAAc,EAAE;YAC5B,WAAW,aAAa,EAAE;YAC1B,SAAS;gBACP,GAAG,iBAAiB;gBACpB;gBACA;YACF;YACA,SAAS,CAAC,SAAS,UAAU,CAAC,IAAI;QACpC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}